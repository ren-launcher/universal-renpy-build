From 7f34a3e47f1e6f2ac1b564670093138e9123ff0a Mon Sep 17 00:00:00 2001
From: fatalc <cnfatal@gmail.com>
Date: Tue, 17 Feb 2026 00:23:56 +0800
Subject: [PATCH 2/8] Drop armv7/i386 support for modern Xcode compatibility

Modern Xcode (12+) has removed support for 32-bit architectures:
- armv7 (iOS device, dropped in Xcode 14 / iOS 11+)
- i386 (iOS Simulator, dropped in Xcode 12 / iOS 14+)

Changes:
- Remove armv7 and i386 from default platform lists
- Update fat binary creation to use arm64 as reference architecture
- Update lipo_and_strip.py to only include x86_64 and arm64
- Raise MIN_SDK from 6.0 to 11.0 (matches arm64-only requirement)
---
 build_all.sh                                         |  2 +-
 dependencies/scripts/build.sh                        | 10 +++++-----
 dependencies/scripts/environment-arm64.sh            |  2 +-
 dependencies/scripts/environment-simulator-x86_64.sh |  2 +-
 dependencies/scripts/lipo_and_strip.py               |  4 +---
 5 files changed, 9 insertions(+), 11 deletions(-)

diff --git a/build_all.sh b/build_all.sh
index 5ba7adf..f751891 100755
--- a/build_all.sh
+++ b/build_all.sh
@@ -3,7 +3,7 @@
 set -e
 
 builds="${1:-debug release}"
-platforms="${2:-x86_64 armv7 arm64 i386}"
+platforms="${2:-x86_64 arm64}"
 
 echo $builds
 echo $platforms
diff --git a/dependencies/scripts/build.sh b/dependencies/scripts/build.sh
index 7d72e5b..ef66594 100755
--- a/dependencies/scripts/build.sh
+++ b/dependencies/scripts/build.sh
@@ -14,7 +14,7 @@ fi
 . $(dirname $0)/environment.sh
 
 builds="${2:-debug release}"
-platforms="${3:-x86_64 i386 armv7 arm64}"
+platforms="${3:-x86_64 arm64}"
 
 for build in $builds; do
   for platform in $platforms; do
@@ -47,15 +47,15 @@ if [ "$RENIOSCOMPONENT" == "all" -o "$RENIOSCOMPONENT" == "final" ]; then
   try mkdir -p $RENIOSDEPROOT/build/debug/lib
 
   # Copy most (non-binary) files from one of the builds, doesn't matter which.
-  try cp -a $RENIOSDEPROOT/build/iphoneos-armv7/debug/include $RENIOSDEPROOT/build/debug/
-  try cp -a $RENIOSDEPROOT/build/iphoneos-armv7/debug/python $RENIOSDEPROOT/build/debug/
+  try cp -a $RENIOSDEPROOT/build/iphoneos-arm64/debug/include $RENIOSDEPROOT/build/debug/
+  try cp -a $RENIOSDEPROOT/build/iphoneos-arm64/debug/python $RENIOSDEPROOT/build/debug/
   # try cp -a $RENIOSDEPROOT/build/iphoneos-armv7s/debug/renpy $RENIOSDEPROOT/build/debug/
 
   try mkdir -p $RENIOSDEPROOT/build/release/lib
 
   # Copy most (non-binary) files from one of the builds, doesn't matter which.
-  try cp -a $RENIOSDEPROOT/build/iphoneos-armv7/release/include $RENIOSDEPROOT/build/release/
-  try cp -a $RENIOSDEPROOT/build/iphoneos-armv7/release/python $RENIOSDEPROOT/build/release/
+  try cp -a $RENIOSDEPROOT/build/iphoneos-arm64/release/include $RENIOSDEPROOT/build/release/
+  try cp -a $RENIOSDEPROOT/build/iphoneos-arm64/release/python $RENIOSDEPROOT/build/release/
   # try cp -a $RENIOSDEPROOT/build/iphoneos-armv7/release/renpy $RENIOSDEPROOT/build/release/
 
   ./scripts/lipo_and_strip.py $RENIOSDEPROOT
diff --git a/dependencies/scripts/environment-arm64.sh b/dependencies/scripts/environment-arm64.sh
index d084b78..74f92a4 100644
--- a/dependencies/scripts/environment-arm64.sh
+++ b/dependencies/scripts/environment-arm64.sh
@@ -7,7 +7,7 @@ export TOOLCHAINROOT=$XCODEPATH/Toolchains/XcodeDefault.xctoolchain
 export SDKBASENAME=iphoneos
 export RENIOSARCH=arm64
 export RENIOSCPU=generic
-export MIN_SDK=6.0
+export MIN_SDK=11.0
 
 if [ ! -d $DEVROOT ]; then
   echo "Unable to found the Xcode iPhoneOS.platform"
diff --git a/dependencies/scripts/environment-simulator-x86_64.sh b/dependencies/scripts/environment-simulator-x86_64.sh
index cb57d82..d7582a2 100644
--- a/dependencies/scripts/environment-simulator-x86_64.sh
+++ b/dependencies/scripts/environment-simulator-x86_64.sh
@@ -7,7 +7,7 @@ export TOOLCHAINROOT=$XCODEPATH/Toolchains/XcodeDefault.xctoolchain
 export SDKBASENAME=iphonesimulator
 export RENIOSARCH=x86_64
 export RENIOSCPU=x86_64
-export MIN_SDK=6.0
+export MIN_SDK=11.0
 
 if [ ! -d $DEVROOT ]; then
   echo "Unable to found the Xcode iPhoneSimulator.platform"
diff --git a/dependencies/scripts/lipo_and_strip.py b/dependencies/scripts/lipo_and_strip.py
index 0f2420f..91dc2ff 100755
--- a/dependencies/scripts/lipo_and_strip.py
+++ b/dependencies/scripts/lipo_and_strip.py
@@ -44,8 +44,6 @@ def run(deproot, build, lib):
 
     platforms = [
         ("x86_64", "iphonesimulator-x86_64"),
-        ("i386", "iphonesimulator-i386"),
-        ("armv7", "iphoneos-armv7"),
         ("arm64", "iphoneos-arm64"),
         ]
 
@@ -83,7 +81,7 @@ def main():
     args = ap.parse_args()
 
     libs = [ ]
-    for fn in os.listdir("{}/build/iphoneos-armv7/release/lib".format(args.deproot)):
+    for fn in os.listdir("{}/build/iphoneos-arm64/release/lib".format(args.deproot)):
         if fn.endswith(".a"):
             libs.append(fn)
 
-- 
2.52.0

