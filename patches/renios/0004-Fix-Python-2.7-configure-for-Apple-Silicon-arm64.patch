From 9e497b1e42ce4995047b2988339f6587ceb1261f Mon Sep 17 00:00:00 2001
From: fatalc <cnfatal@gmail.com>
Date: Tue, 17 Feb 2026 01:25:10 +0800
Subject: [PATCH 4/8] Fix Python 2.7 configure for Apple Silicon (arm64)

Python 2.7.3 configure script only recognizes i386/ppc from /usr/bin/arch.
On Apple Silicon, arch returns arm64 causing 'Unexpected output of arch' error.
Add arm64 as recognized case alongside i386 in both 32-bit and 64-bit branches.
---
 dependencies/scripts/build-python.sh | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/dependencies/scripts/build-python.sh b/dependencies/scripts/build-python.sh
index aa6b2e0..4d56302 100755
--- a/dependencies/scripts/build-python.sh
+++ b/dependencies/scripts/build-python.sh
@@ -40,6 +40,9 @@ CCACHE=ccache
 
 echo 'Building for native machine'
 OSX_SDK_ROOT=`xcrun --sdk macosx --show-sdk-path`
+# Fix configure for Apple Silicon: add arm64 as recognized arch output
+# Python 2.7 configure only knows i386/ppc, arm64 triggers "Unexpected output of arch"
+perl -pi -e 's/^(\s+i386)\)/$1|arm64)/' configure
 try ./configure --enable-ipv6 CC="$CCACHE clang -Qunused-arguments -fcolor-diagnostics" CFLAGS="--sysroot=$OSX_SDK_ROOT"
 try make 2>&1 >/dev/null
 try make Parser/pgen 2>&1 >/dev/null
-- 
2.52.0

